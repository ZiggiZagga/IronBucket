# CI/CD Pipeline Documentation

## Overview

IronBucket implements **production-grade CI/CD pipelines** with comprehensive automation, security scanning, and supply-chain security through SLSA Build Level 3 provenance.

## üîÑ Workflows

### 1. Build and Test (`build-and-test.yml`)

**Triggers:**
- Push to `main` or `develop` branches
- Pull requests to `main` or `develop`

**Actions:**
- ‚úÖ Builds all Maven modules (Pactum-Scroll, Sentinel-Gear, Claimspindel, Brazz-Nossel, Buzzle-Vane)
- ‚úÖ Runs full test suite (231 tests)
- ‚úÖ Caches Maven dependencies for faster builds
- ‚úÖ Uploads test results and build artifacts
- ‚úÖ Generates test summary in GitHub UI

**Expected Results:**
- All modules compile successfully
- All 231 tests pass
- JAR artifacts generated and uploaded

---

### 2. Security Scanning (`security-scan.yml`)

**Triggers:**
- Push to `main` or `develop`
- Pull requests to `main`
- Weekly schedule (Mondays at 00:00 UTC)

**Scans:**

#### a) Dependency Vulnerability Scanning (OWASP)
- Scans all dependencies for known CVEs
- Fails build on CVSS score ‚â• 7
- Generates HTML reports

#### b) Static Analysis (SpotBugs)
- Identifies potential bugs and code smells
- Analyzes compiled bytecode
- Produces XML reports

#### c) Code Style (Checkstyle)
- Enforces coding standards
- Checks formatting and conventions
- Generates violation reports

#### d) Secret Scanning (TruffleHog)
- Scans for accidentally committed secrets
- Checks entire git history
- Only reports verified secrets

**Outputs:**
- Security scan summary in GitHub UI
- Detailed reports as workflow artifacts
- SARIF files for GitHub Security tab

---

### 3. SLSA Provenance (`slsa-provenance.yml`)

**Triggers:**
- Push to `main` branch
- Tag push (v*.*.*)
- Manual workflow dispatch

**Process:**
1. **Build Phase:**
   - Builds all modules with Java 25
   - Collects JAR artifacts
   - Generates SHA256 digests

2. **Provenance Generation:**
   - Uses `slsa-framework/slsa-github-generator@v2.0.0`
   - Generates **SLSA Build Level 3** provenance
   - Creates signed attestations

3. **Verification:**
   - Downloads artifacts and provenance
   - Installs SLSA verifier
   - Verifies provenance authenticity

**Outputs:**
- `ironbucket-provenance.intoto.jsonl` - SLSA attestation
- Verified artifacts with provenance
- Audit trail of build process

---

### 4. Docker Build and Scan (`docker-build.yml`)

**Triggers:**
- Push to `main` or `develop`
- Pull requests to `main`

**Per-Service Actions:**
- Sentinel-Gear
- Claimspindel
- Brazz-Nossel
- Buzzle-Vane

**Process:**
1. Build Maven artifacts
2. Create Docker images with Buildx
3. Scan images with **Trivy** (CRITICAL/HIGH vulnerabilities)
4. Scan images with **Grype** (Anchore)
5. Upload scan results to GitHub Security
6. Push images to GitHub Container Registry (main branch only)

**Image Registry:**
- `ghcr.io/<owner>/ironbucket-sentinel-gear:latest`
- `ghcr.io/<owner>/ironbucket-claimspindel:latest`
- `ghcr.io/<owner>/ironbucket-brazz-nossel:latest`
- `ghcr.io/<owner>/ironbucket-buzzle-vane:latest`

---

### 5. Release (`release.yml`)

**Triggers:**
- Tag push matching `v*.*.*` (e.g., `v1.0.0`)
- Manual workflow dispatch with version input

**Release Process:**

#### Phase 1: Validation
- ‚úÖ Validates semantic version format
- ‚úÖ Checks for clean working tree
- ‚úÖ Verifies repository state

#### Phase 2: Testing
- ‚úÖ Runs complete test suite (231 tests)
- ‚úÖ Fails release if any test fails
- ‚úÖ Validates test result XML files

#### Phase 3: Build
- ‚úÖ Updates POM versions to release version
- ‚úÖ Builds all modules
- ‚úÖ Generates SHA256 and SHA512 checksums
- ‚úÖ Collects release artifacts

#### Phase 4: Provenance
- ‚úÖ Generates SLSA Build Level 3 provenance
- ‚úÖ Signs attestations
- ‚úÖ Links provenance to artifacts

#### Phase 5: Publish
- ‚úÖ Creates GitHub Release
- ‚úÖ Uploads JAR artifacts
- ‚úÖ Uploads checksums
- ‚úÖ Uploads SLSA provenance
- ‚úÖ Generates release notes with verification instructions

#### Phase 6: Docker Images
- ‚úÖ Builds Docker images for all services
- ‚úÖ Tags images with:
  - Exact version (`v1.0.0`)
  - Major.minor (`1.0`)
  - Major (`1`)
  - `latest`
- ‚úÖ Pushes to GitHub Container Registry

---

## üîí Security Features

### Supply-Chain Security (SLSA)

**SLSA Build Level 3 Compliance:**
- ‚úÖ Build from source on hosted CI/CD
- ‚úÖ Provenance generated by trusted builder
- ‚úÖ Tamper-proof provenance signed with Sigstore
- ‚úÖ Provenance includes build parameters and dependencies

**Verification:**
```bash
# Download SLSA verifier
curl -sSL https://github.com/slsa-framework/slsa-verifier/releases/download/v2.5.1/slsa-verifier-linux-amd64 -o slsa-verifier
chmod +x slsa-verifier

# Verify artifact
./slsa-verifier verify-artifact <artifact.jar> \
  --provenance-path ironbucket-provenance.intoto.jsonl \
  --source-uri github.com/ZiggiZagga/IronBucket \
  --source-tag v1.0.0
```

### Container Security

**Image Scanning:**
- **Trivy**: Fast, comprehensive vulnerability scanner
- **Grype**: Anchore's vulnerability scanner
- SARIF results uploaded to GitHub Security tab

**Image Hardening:**
- Eclipse Temurin Java 25 base images
- Multi-stage builds (build + runtime)
- Minimal attack surface
- Regular base image updates

### Dependency Security

**Automated Scanning:**
- OWASP Dependency Check (weekly)
- Fail build on CVSS ‚â• 7
- Suppression file for false positives

### Code Quality

**Static Analysis:**
- SpotBugs for bug detection
- Checkstyle for code standards
- Continuous monitoring

---

## üìä Monitoring & Observability

### GitHub Actions Insights

**Branch Protection:**
- Require passing CI checks
- Require code review
- No direct pushes to `main`

**Status Checks:**
- Build and Test ‚úÖ
- Security Scanning ‚úÖ
- Docker Build ‚úÖ
- SLSA Provenance ‚úÖ

### Artifact Retention

| Artifact Type | Retention | Purpose |
|---------------|-----------|---------|
| Test Results | 30 days | Debugging test failures |
| Build Artifacts | 90 days | Historical builds |
| Security Reports | 30 days | Vulnerability tracking |
| Release Artifacts | Permanent | GitHub Releases |
| Docker Images | Indefinite | GHCR |

---

## üöÄ Usage

### Running Tests Locally

```bash
# Build shared contracts
cd Pactum-Scroll && mvn clean install

# Test individual module
cd Sentinel-Gear && mvn clean test

# Test all modules
for module in Sentinel-Gear Claimspindel Brazz-Nossel Buzzle-Vane; do
  cd $module && mvn clean test && cd ..
done
```

### Creating a Release

```bash
# Tag the release
git tag -a v1.0.0 -m "Release v1.0.0"
git push origin v1.0.0

# CI/CD automatically:
# 1. Runs all tests
# 2. Builds artifacts
# 3. Generates SLSA provenance
# 4. Creates GitHub Release
# 5. Publishes Docker images
```

### Manual Workflow Dispatch

```bash
# Using GitHub CLI
gh workflow run release.yml -f version=v1.0.0

# Or via GitHub UI:
# Actions ‚Üí Release ‚Üí Run workflow ‚Üí Enter version
```

---

## üîß Configuration

### Secrets Required

None! All workflows use `GITHUB_TOKEN` (automatically provided).

### Permissions

Workflows use **least-privilege permissions**:
- `contents: read` - Read repository
- `contents: write` - Create releases
- `packages: write` - Push Docker images
- `id-token: write` - SLSA provenance signing
- `security-events: write` - Upload SARIF

### Branch Protection (Recommended)

```yaml
main:
  required_status_checks:
    - Build and Test
    - Security Scanning
    - Docker Build
  require_pull_request: true
  required_approving_review_count: 1
  dismiss_stale_reviews: true
```

---

## üìà Metrics

### Build Times (Approximate)

| Workflow | Duration |
|----------|----------|
| Build and Test | 5-8 minutes |
| Security Scan | 8-12 minutes |
| Docker Build | 10-15 minutes |
| SLSA Provenance | 6-10 minutes |
| Release (full) | 20-30 minutes |

### Resource Usage

- **Compute**: GitHub-hosted runners (ubuntu-latest)
- **Storage**: ~500 MB per workflow run
- **Network**: ~1 GB downloads (Maven dependencies, Docker layers)

---

## üéØ Best Practices

### 1. Always Test Before Merge
- Run `mvn clean test` locally
- Ensure all 231 tests pass
- Check for new security vulnerabilities

### 2. Semantic Versioning
- Use format: `vMAJOR.MINOR.PATCH`
- Increment appropriately:
  - MAJOR: Breaking changes
  - MINOR: New features
  - PATCH: Bug fixes

### 3. Review Security Reports
- Check GitHub Security tab weekly
- Address HIGH/CRITICAL vulnerabilities
- Update dependencies regularly

### 4. Verify Releases
- Always verify SLSA provenance
- Check artifact checksums
- Test release artifacts before announcing

### 5. Monitor CI/CD Health
- Review failed workflow runs
- Keep workflows updated
- Optimize slow steps

---

## üêõ Troubleshooting

### Build Failures

**Problem:** Maven build fails
**Solution:**
```bash
# Clear Maven cache
rm -rf ~/.m2/repository
mvn clean install -U
```

### Test Failures

**Problem:** Tests pass locally but fail in CI
**Solution:**
- Check Java version (must be 25)
- Review test logs in GitHub Actions
- Check for environment-specific issues

### SLSA Provenance Issues

**Problem:** Provenance generation fails
**Solution:**
- Ensure `id-token: write` permission
- Check SLSA Generator version compatibility
- Verify artifact digests are correct

### Docker Build Failures

**Problem:** Docker image build fails
**Solution:**
- Ensure JAR was built successfully
- Check Dockerfile syntax
- Verify base image availability

---

## üìö References

- [SLSA Framework](https://slsa.dev/)
- [SLSA GitHub Generator](https://github.com/slsa-framework/slsa-github-generator)
- [GitHub Actions Security](https://docs.github.com/en/actions/security-guides)
- [Trivy Scanner](https://github.com/aquasecurity/trivy)
- [OWASP Dependency Check](https://owasp.org/www-project-dependency-check/)

---

**Status:** ‚úÖ Production-Ready CI/CD Pipeline  
**Last Updated:** January 17, 2026  
**Maintained By:** IronBucket Team
